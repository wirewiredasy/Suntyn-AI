{% extends "base.html" %}

{% block title %}AI Resume Generator - Create Professional Resume - Toolora AI{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 pt-20">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Resume Generator Header -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 mx-auto mb-4 rounded-3xl bg-purple-100 dark:bg-purple-900 flex items-center justify-center">
                    <i data-lucide="briefcase" class="w-10 h-10 text-purple-600 dark:text-purple-400"></i>
                </div>
                <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">AI Resume Generator</h1>
                <p class="text-xl text-gray-600 dark:text-gray-300">Create a professional resume in minutes with AI assistance</p>
            </div>

            <!-- Resume Builder Interface -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-8">
                <div x-data="resumeBuilder()" class="space-y-6">
                    <!-- Step Indicator -->
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2" :class="step >= 1 ? 'text-purple-600' : 'text-gray-400'">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center" :class="step >= 1 ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-500'">1</div>
                                <span class="font-medium">Personal Info</span>
                            </div>
                            <div class="w-8 h-px bg-gray-300"></div>
                            <div class="flex items-center space-x-2" :class="step >= 2 ? 'text-purple-600' : 'text-gray-400'">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center" :class="step >= 2 ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-500'">2</div>
                                <span class="font-medium">Experience</span>
                            </div>
                            <div class="w-8 h-px bg-gray-300"></div>
                            <div class="flex items-center space-x-2" :class="step >= 3 ? 'text-purple-600' : 'text-gray-400'">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center" :class="step >= 3 ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-500'">3</div>
                                <span class="font-medium">Generate</span>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1: Personal Information -->
                    <div x-show="step === 1" class="space-y-4">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Personal Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name *</label>
                                <input type="text" x-model="personalInfo.name" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700" placeholder="John Doe">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email *</label>
                                <input type="email" x-model="personalInfo.email" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700" placeholder="john@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Phone</label>
                                <input type="tel" x-model="personalInfo.phone" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700" placeholder="+1 (555) 123-4567">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Location</label>
                                <input type="text" x-model="personalInfo.location" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700" placeholder="New York, NY">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Professional Summary</label>
                            <textarea x-model="personalInfo.summary" rows="4" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700" placeholder="Brief overview of your professional background and career goals..."></textarea>
                        </div>
                    </div>

                    <!-- Step 2: Experience -->
                    <div x-show="step === 2" class="space-y-4">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Professional Experience</h3>
                        <div class="space-y-4">
                            <template x-for="(job, index) in experience" :key="index">
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Job Title</label>
                                            <input type="text" x-model="job.title" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="Software Engineer">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Company</label>
                                            <input type="text" x-model="job.company" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="Tech Corp">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Start Date</label>
                                            <input type="text" x-model="job.startDate" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="Jan 2020">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">End Date</label>
                                            <input type="text" x-model="job.endDate" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="Present">
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                                        <textarea x-model="job.description" rows="3" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="Describe your responsibilities and achievements..."></textarea>
                                    </div>
                                    <button @click="removeExperience(index)" class="text-red-500 hover:text-red-700 text-sm">Remove</button>
                                </div>
                            </template>
                        </div>
                        <button @click="addExperience()" class="btn btn-outline border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                            Add Experience
                        </button>
                    </div>

                    <!-- Step 3: Generate Resume -->
                    <div x-show="step === 3" class="space-y-4">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Generate Your Resume</h3>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Resume Template</label>
                                    <select x-model="resumeOptions.template" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800">
                                        <option value="modern">Modern</option>
                                        <option value="professional">Professional</option>
                                        <option value="creative">Creative</option>
                                        <option value="minimal">Minimal</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Color Scheme</label>
                                    <select x-model="resumeOptions.colorScheme" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800">
                                        <option value="blue">Blue</option>
                                        <option value="green">Green</option>
                                        <option value="purple">Purple</option>
                                        <option value="black">Black</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between pt-6">
                        <button x-show="step > 1" @click="step--" class="btn btn-outline border-gray-300 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i data-lucide="chevron-left" class="w-4 h-4 mr-2"></i>
                            Previous
                        </button>
                        <div x-show="step < 3">
                            <button @click="step++" class="btn btn-primary bg-purple-600 hover:bg-purple-700 ml-auto">
                                Next
                                <i data-lucide="chevron-right" class="w-4 h-4 ml-2"></i>
                            </button>
                        </div>
                        <div x-show="step === 3">
                            <button @click="generateResume()" 
                                    :disabled="processing" 
                                    class="btn btn-primary bg-purple-600 hover:bg-purple-700 btn-lg"
                                    :class="{ 'loading': processing }">
                                <i data-lucide="briefcase" class="w-5 h-5 mr-2" x-show="!processing"></i>
                                <span x-text="processing ? 'Generating...' : 'Generate Resume'"></span>
                            </button>
                        </div>
                    </div>

                    <!-- Progress -->
                    <div x-show="processing" class="space-y-4">
                        <div class="bg-purple-200 dark:bg-purple-700 rounded-full h-3">
                            <div class="bg-purple-600 h-3 rounded-full transition-all duration-300" :style="`width: ${progress}%`"></div>
                        </div>
                        <p class="text-center text-purple-600 dark:text-purple-300 font-medium" x-text="`Generating resume... ${progress}%`"></p>
                    </div>

                    <!-- Result -->
                    <div x-show="result" class="space-y-4">
                        <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg p-6">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i data-lucide="check-circle" class="w-6 h-6 text-green-500"></i>
                                    <div>
                                        <h4 class="font-semibold text-green-800 dark:text-green-200">Resume Generated Successfully!</h4>
                                        <p class="text-green-700 dark:text-green-300">Your professional resume is ready for download</p>
                                    </div>
                                </div>
                                <a x-bind:href="result?.download_url" class="btn btn-primary bg-green-600 hover:bg-green-700">
                                    <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                    Download Resume
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function resumeBuilder() {
    return {
        step: 1,
        processing: false,
        progress: 0,
        result: null,
        personalInfo: {
            name: '',
            email: '',
            phone: '',
            location: '',
            summary: ''
        },
        experience: [
            {
                title: '',
                company: '',
                startDate: '',
                endDate: '',
                description: ''
            }
        ],
        resumeOptions: {
            template: 'modern',
            colorScheme: 'blue'
        },

        addExperience() {
            this.experience.push({
                title: '',
                company: '',
                startDate: '',
                endDate: '',
                description: ''
            });
        },

        removeExperience(index) {
            this.experience.splice(index, 1);
        },

        async generateResume() {
            this.processing = true;
            this.progress = 0;
            this.result = null;

            try {
                const resumeData = {
                    personal_info: this.personalInfo,
                    experience: this.experience,
                    options: this.resumeOptions
                };

                const response = await fetch('/api/ai/generate-resume', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(resumeData)
                });

                const result = await response.json();
                this.progress = 100;

                if (result.success) {
                    this.result = result;
                } else {
                    throw new Error(result.error || 'Resume generation failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error generating resume: ' + error.message);
            } finally {
                this.processing = false;
            }
        }
    }
}
</script>
{% endblock %}